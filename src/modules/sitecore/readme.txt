these have been "borrowed" from SIM's source code